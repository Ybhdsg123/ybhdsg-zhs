import{_ as a,c as i,o as t,ag as h}from"./chunks/framework.By2cXeI6.js";const c=JSON.parse('{"title":"前端工程化 - 资源分包 + 增量构建","description":"","frontmatter":{},"headers":[],"relativePath":"pages/webpack/index.md","filePath":"pages/webpack/index.md"}'),n={name:"pages/webpack/index.md"};function e(l,s,d,p,k,r){return t(),i("div",null,[...s[0]||(s[0]=[h(`<h1 id="前端工程化-资源分包-增量构建" tabindex="-1">前端工程化 - 资源分包 + 增量构建 <a class="header-anchor" href="#前端工程化-资源分包-增量构建" aria-label="Permalink to &quot;前端工程化 - 资源分包 + 增量构建&quot;">​</a></h1><h2 id="一、为什么要做-第三方库单独打包-不重复打包" tabindex="-1">一、为什么要做“第三方库单独打包 + 不重复打包”？ <a class="header-anchor" href="#一、为什么要做-第三方库单独打包-不重复打包" aria-label="Permalink to &quot;一、为什么要做“第三方库单独打包 + 不重复打包”？&quot;">​</a></h2><h3 id="核心目的" tabindex="-1">核心目的： <a class="header-anchor" href="#核心目的" aria-label="Permalink to &quot;核心目的：&quot;">​</a></h3><ul><li>减少每次部署上传的数据量</li><li>提升构建速度</li><li>利用浏览器缓存机制提高加载速度</li><li>便于 CDN 缓存和版本管理</li></ul><h3 id="场景举例" tabindex="-1">场景举例： <a class="header-anchor" href="#场景举例" aria-label="Permalink to &quot;场景举例：&quot;">​</a></h3><table tabindex="0"><thead><tr><th>情况</th><th>是否需要重新打包 vendors</th></tr></thead><tbody><tr><td>修改了页面组件或样式</td><td>❌ 不需要</td></tr><tr><td>升级了 element-ui 版本</td><td>✅ 需要</td></tr><tr><td>新增了一个 npm 包</td><td>✅ 需要</td></tr></tbody></table><h2 id="二、实现方式详解" tabindex="-1">二、实现方式详解 <a class="header-anchor" href="#二、实现方式详解" aria-label="Permalink to &quot;二、实现方式详解&quot;">​</a></h2><h3 id="_1-splitchunks-分包机制-webpack-内置" tabindex="-1">1. SplitChunks 分包机制（Webpack 内置） <a class="header-anchor" href="#_1-splitchunks-分包机制-webpack-内置" aria-label="Permalink to &quot;1. SplitChunks 分包机制（Webpack 内置）&quot;">​</a></h3><h4 id="原理" tabindex="-1">原理： <a class="header-anchor" href="#原理" aria-label="Permalink to &quot;原理：&quot;">​</a></h4><p>Webpack 支持通过 <code>splitChunks</code> 将某些模块提取为单独的 chunk 文件。</p><h4 id="示例配置" tabindex="-1">示例配置： <a class="header-anchor" href="#示例配置" aria-label="Permalink to &quot;示例配置：&quot;">​</a></h4><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config.optimization.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">splitChunks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  chunks: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;all&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cacheGroups: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    coreLibs: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      test:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\\\\</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">/]</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">node_modules</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\\\\</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">/]</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">(vue</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">vue-router</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">vuex</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">element-ui</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">axios</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">lodash</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">echarts)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\\\\</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">/]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;vendors/core&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      enforce: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    defaultVendors: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      test:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\\\\</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">/]</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">node_modules</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\\\\</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">/]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;vendors/other&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      priority: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      reuseExistingChunk: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h4 id="输出结果" tabindex="-1">输出结果： <a class="header-anchor" href="#输出结果" aria-label="Permalink to &quot;输出结果：&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>dist/</span></span>
<span class="line"><span>├── vendors/</span></span>
<span class="line"><span>│   ├── core.[contenthash].js     ← vue, element-ui 等核心依赖</span></span>
<span class="line"><span>│   └── other.[contenthash].js    ← 其他 node_modules 依赖</span></span>
<span class="line"><span>├── js/</span></span>
<span class="line"><span>│   ├── app.[contenthash].js      ← 你的业务代码</span></span>
<span class="line"><span>│   └── chunk-common.[contenthash].js</span></span></code></pre></div><h3 id="_2-使用-contenthash-控制文件名不变" tabindex="-1">2. 使用 contenthash 控制文件名不变 <a class="header-anchor" href="#_2-使用-contenthash-控制文件名不变" aria-label="Permalink to &quot;2. 使用 contenthash 控制文件名不变&quot;">​</a></h3><h4 id="原理-1" tabindex="-1">原理： <a class="header-anchor" href="#原理-1" aria-label="Permalink to &quot;原理：&quot;">​</a></h4><p>Webpack 支持多种 hash 方式：</p><table tabindex="0"><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>[hash]</td><td>所有文件共享一个 hash，只要有一个文件变就全变</td></tr><tr><td>[chunkhash]</td><td>每个 chunk 使用自己的 hash</td></tr><tr><td>[contenthash]</td><td>每个文件根据内容生成 hash（推荐）</td></tr></tbody></table><h4 id="推荐配置" tabindex="-1">推荐配置： <a class="header-anchor" href="#推荐配置" aria-label="Permalink to &quot;推荐配置：&quot;">​</a></h4><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config.output.filename </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`js/[name].[contenthash:10].js\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config.output.chunkFilename </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`js/[name].[contenthash:10].js\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>这样只有文件内容真正变化时才会生成新的 hash 文件名。</p><h3 id="_3-recordspath-固定-chunk-id-避免无变更-hash-变化" tabindex="-1">3. recordsPath 固定 chunk ID（避免无变更 hash 变化） <a class="header-anchor" href="#_3-recordspath-固定-chunk-id-避免无变更-hash-变化" aria-label="Permalink to &quot;3. recordsPath 固定 chunk ID（避免无变更 hash 变化）&quot;">​</a></h3><h4 id="原理-2" tabindex="-1">原理： <a class="header-anchor" href="#原理-2" aria-label="Permalink to &quot;原理：&quot;">​</a></h4><p>Webpack 默认会动态分配 chunk ID，即使内容没变，ID 也可能不同，导致 hash 变化。</p><h4 id="解决方法" tabindex="-1">解决方法： <a class="header-anchor" href="#解决方法" aria-label="Permalink to &quot;解决方法：&quot;">​</a></h4><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">recordsPath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(path.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(__dirname, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;webpack.records.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span></code></pre></div><p>Webpack 会把 chunk ID 记录到这个文件中，确保相同依赖生成相同的 hash。</p><blockquote><p>⚠️ 注意：这个文件应该加入 <code>.gitignore</code>，因为它包含本地路径信息。</p></blockquote><h3 id="_4-增量部署策略-只上传变动的文件" tabindex="-1">4. 增量部署策略（只上传变动的文件） <a class="header-anchor" href="#_4-增量部署策略-只上传变动的文件" aria-label="Permalink to &quot;4. 增量部署策略（只上传变动的文件）&quot;">​</a></h3><h4 id="实现方式" tabindex="-1">实现方式： <a class="header-anchor" href="#实现方式" aria-label="Permalink to &quot;实现方式：&quot;">​</a></h4><p>你可以写一个脚本，在每次构建后对比上次构建的输出目录，找出新增或变更的文件。</p><h5 id="示例脚本" tabindex="-1">示例脚本： <a class="header-anchor" href="#示例脚本" aria-label="Permalink to &quot;示例脚本：&quot;">​</a></h5><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 对比 dist 目录与上一次 build 的 dist_last 目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">diff</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dist/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dist_last/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;^Only&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> awk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{print $2}&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changed_files.txt</span></span></code></pre></div><p>然后只上传 <code>changed_files.txt</code> 中列出的文件。</p><h3 id="_5-cdn-静态资源托管-可选" tabindex="-1">5. CDN 静态资源托管（可选） <a class="header-anchor" href="#_5-cdn-静态资源托管-可选" aria-label="Permalink to &quot;5. CDN 静态资源托管（可选）&quot;">​</a></h3><p>如果你希望进一步优化部署流程，可以将 <code>vendors/</code> 目录部署到 CDN 上：</p><h4 id="步骤" tabindex="-1">步骤： <a class="header-anchor" href="#步骤" aria-label="Permalink to &quot;步骤：&quot;">​</a></h4><ol><li>构建完成后，将 <code>vendors/</code> 上传到 CDN；</li><li>在 <code>index.html</code> 中引用这些 CDN 资源；</li><li>后续构建只需更新业务代码（<code>js/app.*.js</code>）；</li></ol><h4 id="示例" tabindex="-1">示例： <a class="header-anchor" href="#示例" aria-label="Permalink to &quot;示例：&quot;">​</a></h4><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> src</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://cdn.example.com/vendors/core.abc123.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> src</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://cdn.example.com/vendors/other.def456.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h2 id="三、最终效果总结" tabindex="-1">三、最终效果总结 <a class="header-anchor" href="#三、最终效果总结" aria-label="Permalink to &quot;三、最终效果总结&quot;">​</a></h2><table tabindex="0"><thead><tr><th>项目</th><th>效果</th></tr></thead><tbody><tr><td>第三方库</td><td>独立打包为 <code>vendors/core.js</code> 和 <code>vendors/other.js</code></td></tr><tr><td>文件名控制</td><td>使用 <code>contenthash</code>，内容不变则文件名不变</td></tr><tr><td>chunk ID 控制</td><td>使用 <code>recordsPath</code> 固定 ID，防止 hash 变动</td></tr><tr><td>构建效率</td><td>第三方库不会重复打包</td></tr><tr><td>部署效率</td><td>只需上传业务代码相关文件，无需重复上传 <code>vendors</code></td></tr><tr><td>CDN 支持</td><td>可将 <code>vendors</code> 托管至 CDN，进一步提升性能</td></tr></tbody></table><h2 id="衍生建议" tabindex="-1">衍生建议 <a class="header-anchor" href="#衍生建议" aria-label="Permalink to &quot;衍生建议&quot;">​</a></h2><table tabindex="0"><thead><tr><th>功能</th><th>推荐做法</th></tr></thead><tbody><tr><td>查看哪些文件发生了变化</td><td>使用 <code>git diff --name-only</code> 或文件对比脚本</td></tr><tr><td>自动上传变更文件</td><td>使用 shell 脚本 + rsync / scp / ftp / sftp</td></tr><tr><td>统计包体积变化</td><td>使用 <code>webpack-bundle-analyzer</code> 插件</td></tr><tr><td>自动清理旧版本文件</td><td>设置服务器定期清理过期的 <code>vendors</code> 文件</td></tr></tbody></table><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p>你现在已具备以下能力：</p><p>✅ 将常用第三方库独立打包为 <code>vendors/</code> 目录下的稳定文件<br> ✅ 业务代码每次只打包变动部分，极大提升构建效率<br> ✅ 通过 hash 控制缓存和 CDN 加速，提升用户体验<br> ✅ 通过记录机制固定 chunk ID，避免无变更也重新上传</p><p>这是一套适用于大型 Vue 项目的标准上线优化方案，特别适合企业级后台管理系统、SaaS 平台等对部署效率要求较高的场景。</p>`,48)])])}const E=a(n,[["render",e]]);export{c as __pageData,E as default};
